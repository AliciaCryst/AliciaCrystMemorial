<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Echoes of Alicia</title>
  <style>
    body {
      background-color: #111;
      color: #f0f0f0;
      font-family: 'Georgia', serif;
      padding: 2em;
      line-height: 1.6;
    }
    h2, h3 {
      color: #f9c;
    }
    textarea {
      width: 100%;
      background-color: #222;
      color: #fff;
      padding: 1em;
      margin-top: 1em;
    }
    button {
      padding: 0.5em 1em;
      margin-top: 0.5em;
      background: #444;
      color: #fff;
      border: none;
    }
    .story {
      background: #1a1a1a;
      padding: 1em;
      margin-top: 1em;
      border-left: 3px solid #555;
    }
    .fade-in-entry {
      animation: fadeIn 1s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
  </style>
</head>
<body>

<h2>The Eternal Wall ‚Äì A Memoir in Code & Longing</h2>
<p class="quote">‚ÄúHer genome was the memoir she never wrote.‚Äù</p>
<p>Here hangs her typographic soul. Submit a memory. Read the echoes. Light a diya. Witness. Remember.</p>

<textarea id="storyInput" rows="5" placeholder="Write your story..."></textarea>
<br>
<button onclick="submitStory()">Submit üìù</button>
<button onclick="activateAdmin()">üîê Admin Login</button>
<p id="confirmation" style="color:#7fd;"></p>

<div id="stories">
  <h3>Shared Memories</h3>
  <div id="storyList"></div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBy6Il_3UJsCkyR7TFwGcVn12eONTy7v_g",
    authDomain: "aliciacrystmemorial.firebaseapp.com",
    projectId: "aliciacrystmemorial",
    storageBucket: "aliciacrystmemorial.firebasestorage.app",
    messagingSenderId: "258617426442",
    appId: "1:258617426442:web:ec7e31541f311049e855f3",
    measurementId: "G-NQZ441QWE5"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  let adminMode = false;

  function activateAdmin() {
    const pass = prompt("Enter admin passphrase:");
    if (pass === "EternalAlicia95135!") {
      adminMode = true;
      loadStories();
    } else {
      alert("Incorrect passphrase.");
    }
  }

  function submitStory() {
    const text = document.getElementById("storyInput").value.trim();
    if (!text) return;
    db.collection("stories").add({
      text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      document.getElementById("storyInput").value = "";
      document.getElementById("confirmation").textContent = "‚úÖ Story shared.";
    });
  }

  function deleteStory(id) {
    if (adminMode && confirm("Delete this story?")) {
      db.collection("stories").doc(id).delete();
    }
  }

  function updateStory(id, newText) {
    db.collection("stories").doc(id).update({ text: newText });
  }

  function loadStories() {
    db.collection("stories").orderBy("timestamp", "desc").onSnapshot(snapshot => {
      const list = document.getElementById("storyList");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const storyDiv = document.createElement("div");
        storyDiv.className = "story fade-in-entry";

        const contentP = document.createElement("p");
        contentP.textContent = data.text;
        storyDiv.appendChild(contentP);

        if (data.timestamp && data.timestamp.toDate) {
          const ts = data.timestamp.toDate().toLocaleString();
          const tsDiv = document.createElement("div");
          tsDiv.style.fontSize = "0.8em";
          tsDiv.style.color = "#aaa";
          tsDiv.textContent = `üïì Shared on ${ts}`;
          storyDiv.appendChild(tsDiv);
        }

        if (adminMode) {
          const editBtn = document.createElement("button");
          editBtn.textContent = "‚úèÔ∏è Edit";
          editBtn.onclick = () => {
            const textarea = document.createElement("textarea");
            textarea.value = data.text;
            const saveBtn = document.createElement("button");
            saveBtn.textContent = "‚úÖ Save";
            const cancelBtn = document.createElement("button");
            cancelBtn.textContent = "‚ùå Cancel";

            // Clear and replace
            storyDiv.innerHTML = "";
            storyDiv.appendChild(textarea);
            storyDiv.appendChild(saveBtn);
            storyDiv.appendChild(cancelBtn);

            saveBtn.onclick = () => {
              const newText = textarea.value.trim();
              if (newText) {
                updateStory(doc.id, newText);
              }
            };
            cancelBtn.onclick = loadStories;
          };
          storyDiv.appendChild(editBtn);

          const delBtn = document.createElement("button");
          delBtn.textContent = "üóëÔ∏è Delete";
          delBtn.onclick = () => deleteStory(doc.id);
          storyDiv.appendChild(delBtn);
        }

        list.appendChild(storyDiv);
      });
    });
  }

  window.addEventListener("DOMContentLoaded", loadStories);
</script>
</body>
</html>
